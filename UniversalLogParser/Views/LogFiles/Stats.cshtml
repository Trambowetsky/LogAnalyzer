@{
    ViewData["Title"] = "Log Files Dashboard";
}

<div class="container mt-5">
    <h2 class="text-center mb-4 fw-bold text-light">Logs Dashboard</h2>

    <div class="text-center mb-4">
        <a asp-controller="LogFiles" asp-action="Index"
           class="btn btn-outline-light btn-sm px-4 py-2 shadow-sm">
            ‚Üê Back to main page
        </a>
    </div>

    <div class="row g-4 mb-5">
        <div class="col-md-6">
            <div class="card shadow-sm p-4 h-100 text-center">
                <h5 class="fw-semibold mb-3 text-light">Amount of Entries per File</h5>
                <canvas id="fileCountChart" style="height: 300px;"></canvas>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card shadow-sm p-4 h-100 text-center">
                <h5 class="fw-semibold mb-3 text-light">Average Error Amount</h5>
                <canvas id="errorRatioChart" style="height: 300px;"></canvas>
            </div>
        </div>

        <div class="col-12">
            <div class="card shadow-sm p-4 h-100 text-center">
                <h5 class="fw-semibold mb-3 text-light">Activity by Time</h5>
                <canvas id="activityChart" style="height: 300px;"></canvas>
            </div>
        </div>

        <div class="col-12 col-md-6 mx-auto">
            <div class="card shadow-sm p-4 h-100 text-center">
                <h5 class="fw-semibold mb-3 text-light">Log Level Distribution</h5>
                <div class="d-flex justify-content-center align-items-center" style="height: 300px;">
                    <canvas id="logLevelDistrChart" style="max-height: 280px; width: 100%; max-width: 400px;"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const res = await fetch('/LogFiles/GetDashboardData');
            const data = await res.json();

            new Chart(document.getElementById('fileCountChart'), {
                type: 'bar',
                data: {
                    labels: data.fileNames,
                    datasets: [{
                        label: 'Entries',
                        data: data.entryCounts,
                        backgroundColor: 'rgba(54, 162, 235, 0.7)',
                        borderRadius: 6
                    }]
                },
                options: { scales: { y: { beginAtZero: true } } }
            });

            new Chart(document.getElementById('errorRatioChart'), {
                type: 'bar',
                data: {
                    labels: data.fileNames,
                    datasets: [{
                        label: '% Errors & Warnings',
                        data: data.errorRatios,
                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                        borderRadius: 6
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: v => v + '%' }
                        }
                    }
                }
            });

            new Chart(document.getElementById('activityChart'), {
                type: 'line',
                data: {
                    labels: data.activity.map(a => a.hour + ':00'),
                    datasets: [{
                        label: 'Messages',
                        data: data.activity.map(a => a.count),
                        borderColor: '#4BC0C0',
                        fill: true,
                        tension: 0.4
                    }]
                }
            });

            new Chart(document.getElementById('logLevelDistrChart'), {
                type: 'doughnut',
                data: {
                    labels: data.levelDistribution.map(l => l.level),
                    datasets: [{
                        data: data.levelDistribution.map(l => l.count),
                        backgroundColor: ['#4e79a7','#f28e2b','#e15759','#76b7b2','#59a14f']
                    }]
                },
                options: { plugins: { legend: { position: 'bottom' } } }
            });
        });
    </script>
}

<style>
    body {
        background-color: #1E1E1E;
        color: #E0E0E0;
    }
    .card {
        background-color: #2A2A2A;
        border: 1px solid #333;
        border-radius: 16px;
    }
</style>